FROM registry.gitlab.com/ronen48/ciy/python-311:latest

RUN apt-get update -y
RUN apt install iptables wget dos2unix -y

COPY internal_controller/startup.rc.local /etc/rc.local
COPY internal_controller.bin /usr/src/app/main
RUN chmod 0777 /usr/src/app/main

RUN wget -O /usr/local/bin/k3s https://github.com/k3s-io/k3s/releases/download/v1.27.9+k3s1/k3s
RUN wget -O /usr/local/src/install.sh https://get.k3s.io/
RUN chmod 0777 /usr/local/src/install.sh
RUN chmod 0777 /usr/local/bin/k3s

RUN dos2unix /etc/rc.local
RUN chmod +x /etc/rc.local
